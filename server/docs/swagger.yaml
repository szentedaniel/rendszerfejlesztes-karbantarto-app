openapi: '3.0.2'
info:
  title: Rendszerfejlesztes API
  version: '1.0'
servers:
  - url: http://localhost:3000/api

components:
    schemas:
      # Device schema
      Device:
        type: object
        properties:
          id:
            type: integer
            default: Auto-generated
          name:
            type: string
          description:
            type: string
          identifier:
            type: string
          location:
            $ref: '#/components/schemas/Location'
          locationId:
            type: integer
          category:
            $ref: '#/components/schemas/Category'
          categoryId:
            type: integer
      # Location schema
      Location:
        type: object
        properties:
          id:
            type: integer
            default: Auto-generated
          name:
            type: string
          building:
            $ref: '#/components/schemas/Building'
          buildingId: 
            type: integer
          Device:
            type: array
            items:
              $ref: '#/components/schemas/Device'
      # Building schema
      Building:
        type: object
        properties:
          id: 
            type: integer
            default: Auto-generated
          name: 
            type: string
          Location:
            type: array
            items:
              $ref: '#/components/schemas/Location'
      # Category schema
      Category:
        type: object
        properties:
          id: 
            type: integer
            default: Auto-generated
          name: 
            type: string
          Device:
            type: array
            items:
              $ref: '#/components/schemas/Device'
          Maintenance:
            type: array
            items:
              $ref: '#/components/schemas/Maintenance'
          children:
            type: array
            items:
              $ref: '#/components/schemas/Category'
          parent:
            $ref: '#/components/schemas/Category'
            nullable: true
          parentId:
            type: integer
            nullable: true
      # Period schema
      Period:
        type: object
        properties:
          id: 
            type: integer
            default: Auto-generated
          name: 
            type: string
          days:
            type: integer
          Category:
            type: array
            items:
              $ref: '#/components/schemas/Category'
      # Maintenance schema
      Maintenance:
        type: object
        properties:
            id: 
              type: integer
              default: Auto-generated
            name: 
              type: string
            Instruction:
              type: array
              items:
                $ref: '#/components/schemas/Instruction'
            exceptive: 
              type: boolean
              default: false
            categoryId: 
              type: integer
            category:
              $ref: '#/components/schemas/Category'
            MaintenanceQualification:
              type: array
              items:
                $ref: '#/components/schemas/MaintenanceQualification'
            Task:
              type: array
              items:
                $ref: '#/components/schemas/Task'
      # Instruction schema
      Instruction:
        type: object
        properties:
          id:
            type: integer
            default: Auto-generated
          title:
            type: string
            nullable: true
          body:
            type: string
          done:
            type: boolean
            default: false
          maintenance:
            $ref: '#/components/schemas/Maintenance'
          maintenanceId:
            type: integer
      # User schema
      User:
        type: object
        properties:
          id:
            type: integer
            default: Auto-generated
          name:
            type: string
          createdAt:
            type: string
            format: date-time
            default: Auto-generated   
          updatedAt:
            type: string
            format: date-time
            default: Auto-generated      
          username:
            type: string
          password:
            type: string
            format: password
          Role:
            $ref: '#/components/schemas/Role'
          roleId:
            type: integer
          UserQualification:
            type: array
            items:
              $ref: '#/components/schemas/UserQualification'
          Task:
            type: array
            items:
              $ref: '#/components/schemas/Task'
      # Qualification schema
      Qualification:
        type: object
        properties:
          id:
            type: integer
            default: Auto-generated
          name:
            type: string
          UserQualification:
            type: array
            items:
              $ref: '#/components/schemas/UserQualification'
          MaintenanceQualification:
            type: array
            items:
              $ref: '#/components/schemas/MaintenanceQualification'
      # UserQualification schema
      UserQualification:
        type: object
        properties:
          qualification:
            $ref: '#/components/schemas/Qualification'
          qualificationId:
            type: integer
          user:
            $ref: '#/components/schemas/User'
          userId:
            type: integer
      # Role schema
      Role:
        type: object
        properties:
          id:
            type: integer
            default: Auto-generated
          name:
            type: string
          User:
            type: array
            items:
              $ref: '#/components/schemas/User'
      # MaintenanceQualification schema
      MaintenanceQualification:
        type: object
        properties:
          qualification:
            $ref: '#/components/schemas/Qualification'
          qualificationId:
            type: integer
          maintenance:
            $ref: '#/components/schemas/Maintenance'
          maintenanceId:
            type: integer
      # Task schema
      Task:
        type: object
        properties:
          id:
            type: integer
          maintenanceId:
            type: integer
          maintenance:
            $ref: '#/components/schemas/Maintenance'
          userId:
            type: integer
          user:
            $ref: '#/components/schemas/User'
          description:
            type: string
            nullable: false
          scheduled:
            type: string
            format: date-time
          generated:
            type: boolean
          assignedAt:
            type: string
            format: date-time
            default: Auto-generated
          updatedAt:
            type: string
            format: date-time #updatedAt is missing!
            default: Auto-generated
          acceptedAt:
            type: string
            format: date-time
            nullable: true
          declinedAt:
            type: string
            format: date-time
            nullable: true
          startedAt:
            type: string
            format: date-time
            nullable: true
          finishedAt:
            type: string
            format: date-time
            nullable: true
          priorityId:
            type: number
            default: 3
          priority:
            $ref: '#/components/schemas/Priority'
          statusId:
            type: integer
          status:
            $ref: '#/components/schemas/Status'
          lastTask:
            $ref: '#/components/schemas/Maintenance'
      # Status schema
      Status:
        type: object
        properties:
          id:
            type: integer
            default: Auto-generated
          name:
            type: string
          Task:
            type: array
            items:
              $ref: '#/components/schemas/Task'
      # Priority schema
      Priority:
        type: object
        properties:
          id:
            type: integer
          name:
            type: string
          priority:
            type: integer
          Task:
            type: array
            items:
              $ref: '#/components/schemas/Task'

      Login:
        type: object
        properties:
          username:
            type: string
            nullable: false
          password:
            type: string
            nullable: false
      # Error schema
      NotFound:
        type: object
        properties:
          status:
            type: integer
            default: 404
          message:
            type: string
            default: Not found with this id
      ServerError:
        type: object
        properties:
          status:
            type: integer
            default: 500
          message:
            type: string
            default: Error message

#      Post:
#        type: object
#        required:
#          - userId
#          - title
#          - body
#        properties:
#          id:
#            type: integer
#          userId:
#            type: integer
#          title:
#            type: string
#          body:
#            type: string
#        example:
#          id: 1
#          userId: 1
#          title: my title
#          body: my article
paths:
  /users:
    get:
      summary: Returns all users
      tags: [Users]
      responses:
        200:
          description: the list of the users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'



  /users/{id}:
    get:
      summary: Returns a user by id
      tags: [Users]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        200:
          description: Details of a user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
    delete:
      summary: Delete a user by id
      tags: [Users]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        200:
          description: The user was successfully deleted and the data of the deleted user is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        404:
          description: The user was not found with this id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFound'
        500:
          description: The user could not be deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerError'
    patch:
      summary: Update a user by id
      tags: [Users]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      requestBody:
        content:
          application/json:     
            schema:             
              $ref: '#/components/schemas/User'
            examples:    
              Example1:   
                value:
                  username: New username
              Example2:   
                value:
                  name: New name
                  username: New username
              Example3:   
                value:
                  name: New name
                  username: New username
                  password: New password
              Example4:   
                value:
                  name: New name
                  username: New username
                  password: New password
                  userId: 1
      responses:
        200:
          description: The user was successfully updated and the data of the updated user is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        404:
          description: The user was not found with this id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFound'
        500:
          description: The user could not be updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerError'



  /user:
    post:
      summary: Adds a new user
      tags: [Users]
      requestBody:
        content:
          application/json:     
            schema:             
              $ref: '#/components/schemas/User'   
            examples:    
              Jessica:   
                value:
                  name: Jessica Smith
                  username: jessica_s
                  password: passw1234
                  roleId: 1
              Ron:       
                value:
                  name: Ron Stewart
                  username: ron_s
                  password: secret987
                  roleId: 1
      responses:
        200:
          description: The user was successfully created and the data of the created user is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        500:
          description: The user could not be created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerError'
  /login:
    post:
      summary: Login
      tags: [Users]
      requestBody:
        content:
          application/json:     
            schema:             
              $ref: '#/components/schemas/Login'   
            examples:    
              Working example:   
                value:
                  username: admin
                  password: admin
              Bad password:       
                value:
                  username: admin
                  password: password
              Not found example:
                value:
                  username: pityu
                  password: notapassword
      responses:
        '200':
          description: Successfully logged in
        404:
          description: Not found
        401:
          description: Wrong password

# QUALIFICATIONS
  /qualifications:
    get:
      summary: Returns all qualifications
      tags: [Qualifications]
      responses:
        200:
          description: the list of the qualifications
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Qualification'

  /qualification/{id}:
    get:
      summary: Returns a qualification by id
      tags: [Qualifications]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        200:
          description: Details of a qualification
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Qualification'
    delete:
      summary: Delete a qualification by id
      tags: [Qualifications]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        200:
          description: The qualification was successfully deleted and the data of the deleted qualification is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Qualification'
        500:
          description: The qualification could not be deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerError'
    patch:
      summary: Update a qualification by id
      tags: [Qualifications]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      requestBody:
        content:
          application/json:     
            schema:             
              $ref: '#/components/schemas/Qualification'
            examples:
              Example1:   
                value:
                  name: New name
      responses:
        200:
          description: The qualification was successfully updated and the data of the updated qualification is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Qualification'
        500:
          description: The qualification could not be updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerError'
  /qualification:
    post:
      summary: Adds a new qualification
      tags: [Qualifications]
      requestBody:
        content:
          application/json:     
            schema:             
              $ref: '#/components/schemas/Qualification'   
            examples:    
              Example1:   
                value:
                  name: New name
      responses:
        200:
          description: The qualification was successfully created and the data of the created category is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Qualification'
        500:
          description: The qualification could not be created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerError'

      
# CATEGORIES
  /categories:
    get:
      summary: Returns all categories
      tags: [Categories]
      responses:
        200:
          description: the list of the categories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'
  
  /categories/details:
    get:
      summary: Returns all categories with details
      tags: [Categories]
      responses:
        200:
          description: the list of the categories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'
        
  /categories/{id}:
    get:
      summary: Returns a category by id
      tags: [Categories]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        200:
          description: Details of a category
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
    delete:
      summary: Delete a category by id
      tags: [Categories]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        200:
          description: The category was successfully deleted and the data of the deleted category is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'
        404:
          description: The category was not found with this id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFound'
        500:
          description: The category could not be deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerError'
    patch:
      summary: Update a category by id
      tags: [Categories]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      requestBody:
        content:
          application/json:     
            schema:             
              $ref: '#/components/schemas/Category'
            examples:    
              Example1:   
                value:
                  name: New name
              Example2:   
                value:
                  name: New name
                  parentId: 1
      responses:
        200:
          description: The category was successfully updated and the data of the updated category is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'
        404:
          description: The category was not found with this id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFound'
        500:
          description: The category could not be updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerError'

  /categories/{id}/details:
    get:
      summary: Returns a category by id
      tags: [Categories]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        200:
          description: Details of a category
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'

  /category:
    post:
      summary: Adds a new category
      tags: [Categories]
      requestBody:
        content:
          application/json:     
            schema:             
              $ref: '#/components/schemas/Category'   
            examples:    
              Example1:   
                value:
                  name: New name
                  parentId: 1
              Example2:   
                value:
                  name: New name2
                  parentId: null
      responses:
        200:
          description: The category was successfully created and the data of the created category is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'
        500:
          description: The category could not be created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerError'

# DEVICES
  /devices:
    get:
      summary: Returns all devices
      tags: [Devices]
      responses:
        200:
          description: the list of the devices
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Device'

  /devices/{id}:
    get:
      summary: Returns a device by id
      tags: [Devices]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        200:
          description: Details of a device
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Device'
    delete:
      summary: Delete a device by id
      tags: [Devices]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        200:
          description: The device was successfully deleted and the data of the deleted device is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Device'
        404:
          description: The device was not found with this id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFound'
        500:
          description: The device could not be deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerError'
    patch:
      summary: Update a device by id
      tags: [Devices]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      requestBody:
        content:
          application/json:     
            schema:             
              $ref: '#/components/schemas/Device'
            examples:    
              Example1:   
                value:
                  name: New name
              Example2:   
                value:
                  name: New name
                  description: null
              Example3:   
                value:
                  name: New name
                  description: null
                  identifier: NEW001
              Example4:   
                value:
                  name: New name
                  description: null
                  identifier: NEW001
                  locationId: 1
              Example5:   
                value:
                  name: New name
                  description: null
                  identifier: NEW001
                  locationId: 1
                  categoryId: 1
      responses:
        200:
          description: The device was successfully updated and the data of the updated device is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Device'
        404:
          description: The category was not found with this id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFound'
        500:
          description: The device could not be updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerError'

  /device:
    post:
      summary: Adds a new device
      tags: [Devices]
      requestBody:
        content:
          application/json:     
            schema:             
              $ref: '#/components/schemas/Device'   
            examples:    
              Example1:   
                value:
                  name: New name
                  description: New description
                  identifier: NEW001
                  locationId: 1
                  categoryId: 1
              Example2:   
                value:
                  name: New name
                  description: null
                  identifier: NEW001
                  locationId: 1
                  categoryId: 1
      responses:
        200:
          description: The device was successfully created and the data of the created device is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Device'
        500:
          description: The device could not be created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerError'

  # MAINTENANCES
  /maintenances:
    get:
      summary: Returns all maintenances
      tags: [Maintenances]
      responses:
        200:
          description: the list of the maintenances
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Maintenance'
  
  /maintenances/details:
    get:
      summary: Returns all maintenances with details
      tags: [Maintenances]
      responses:
        200:
          description: the list of the maintenances
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Maintenance'
        
  /maintenances/{id}:
    get:
      summary: Returns a maintenance by id
      tags: [Maintenances]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        200:
          description: Details of a maintenance
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Maintenance'
    delete:
      summary: Delete a maintenance by id
      tags: [Maintenances]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        200:
          description: The maintenance was successfully deleted and the data of the deleted maintenance is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Maintenance'
        404:
          description: The maintetnance was not found with this id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFound'
        500:
          description: The maintenance could not be deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerError'
    patch:
      summary: Update a maintenance by id
      tags: [Maintenances]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      requestBody:
        content:
          application/json:     
            schema:             
              $ref: '#/components/schemas/Maintenance'
            examples:    
              Example1:   
                value:
                  name: New name
              Example2:   
                value:
                  name: New name
                  normaInMinutes: 50
              Example3:   
                value:
                  name: New name
                  normaInMinutes: 50
                  lastMaintenanceId: 1
              Example4:   
                value:
                  name: New name
                  normaInMinutes: 50
                  lastMaintenanceId: 1
                  periodId: 1
              Example5:   
                value:
                  name: New name
                  normaInMinutes: 50
                  lastMaintenanceId: 1
                  periodId: 1
                  categoryId: 1
              Norma and Period:   
                value:
                  normaInMinutes: 5
                  periodId: 1
              Only norma:   
                value:
                  normaInMinutes: 5
              Only period:   
                value:
                  periodId: 1
      responses:
        200:
          description: The maintenance was successfully updated and the data of the updated maintenance is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Maintenance'
        404:
          description: The maintenance was not found with this id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFound'
        500:
          description: The maintenance could not be updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerError'

  /maintenances/{id}/details:
    get:
      summary: Returns a maintenance by id
      tags: [Maintenances]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        200:
          description: Details of a maintenance
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Maintenance'

  /maintenance:
    post:
      summary: Adds a new maintenance
      tags: [Maintenances]
      requestBody:
        content:
          application/json:     
            schema:             
              $ref: '#/components/schemas/Maintenance'   
            examples:    
              Example1:   
                value:
                  name: New name
                  normaInMinutes: 50
                  categoryId: 1
              Example2:   
                value:
                  name: New name
                  normaInMinutes: 50
                  lastMaintenanceId: 1
                  periodId: 1
                  categoryId: 1
      responses:
        200:
          description: The maintenance was successfully created and the data of the created maintenance is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Maintenance'
        500:
          description: The maintenance could not be created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerError'
# INSTRUCTIONS
  /instructions:
    get:
      summary: Returns all instructions
      tags: [Instructions]
      responses:
        200:
          description: the list of the instructions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Instruction'
  
  /instructions/{id}:
    delete:
      summary: Delete an instruction by id
      tags: [Instructions]
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
      responses:
        200:
          description: The instruction was successfully deleted and the data of the deleted maintenance is returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Instruction'
        404:
          description: The instruction was not found with this id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotFound'
        500:
          description: The instruction could not be deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerError'
